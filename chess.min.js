/*! chess.js | (c) 2021 Chris Oakman | license: MIT */
(function(global, factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self,global.Chess=factory())})(this,function(){"use strict";var e="pnbrqkPNBRQK",t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",r=["1-0","0-1","1/2-1/2","*"],n={b:[16,32,17,15],w:[-16,-32,-17,-15]},o={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},i=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],a=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],s={p:0,n:1,b:2,r:3,q:4,k:5},f={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},u=7,d=6,l=5,c=4,h=3,v=2,g=1,b=0,w={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},m={w:[{square:w.a1,flag:f.QSIDE_CASTLE},{square:w.h1,flag:f.KSIDE_CASTLE}],b:[{square:w.a8,flag:f.QSIDE_CASTLE},{square:w.h8,flag:f.KSIDE_CASTLE}]},p=0,y=1,x=2,S=3,T=4,C=5,O=6;function k(e,t){for(var r=e.from,n=e.to,o=e.piece,i=0,a=0,s=0,f=0,u=t.length;f<u;f++){var d=t[f].from,l=t[f].to;o===t[f].piece&&r!==d&&n===l&&(i++,rank(r)===rank(d)&&a++,file(r)===file(d)&&s++)}return 0<i?0<a&&0<s?algebraic(r):0<s?algebraic(r).charAt(1):algebraic(r).charAt(0):""}function infer_piece_type(e){var t=e.charAt(0);return"a"<=t&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:"p":"o"===(t=t.toLowerCase())?"k":t}function stripped_san(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function rank(e){return e>>4}function file(e){return 15&e}function algebraic(e){var t=file(e),e=rank(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function swap_color(e){return"w"===e?"b":"w"}function is_digit(e){return-1!=="0123456789".indexOf(e)}function clone(e){var t,r=e instanceof Array?[]:{};for(t in e)r[t]="object"==typeof e[t]?clone(e[t]):e[t];return r}function trim(e){return e.replace(/^\s+|\s+$/g,"")}var N="b",A="w",E=-1,P="p",M="n",B="b",F="r",H="q",j="k",K=function(e){for(var t=[],r=w.a8;r<=w.h1;r++)136&r?r+=7:t.push(algebraic(r));return t}(),L={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"};function D(e){return new R(e)}function R(e){var y=new Array(128),x={w:E,b:E},S=A,T={w:0,b:0},C=E,O=0,k=1,N=[],A={},P={};function M(e){void 0===e&&(e=!1),y=new Array(128),x={w:E,b:E},S=A,T={w:0,b:0},C=E,O=0,k=1,N=[],e||(A={},P={}),Lr(q())}function B(){W(t)}function W(e,r){void 0===r&&(r=!1);var n=e.split(/\s+/),o=n[0],i=0;if(!X(e).valid)return!1;M(r);for(var a=0;a<o.length;a++){var s,f=o.charAt(a);"/"===f?i+=8:is_digit(f)?i+=parseInt(f,10):(s=f<"a"?A:"b",z({type:f.toLowerCase(),color:s},algebraic(i)),i++)}return S=n[1],-1<n[2].indexOf("K")&&(T.w|=f.KSIDE_CASTLE),-1<n[2].indexOf("Q")&&(T.w|=f.QSIDE_CASTLE),-1<n[2].indexOf("k")&&(T.b|=f.KSIDE_CASTLE),-1<n[2].indexOf("q")&&(T.b|=f.QSIDE_CASTLE),C="-"===n[3]?E:w[n[3]],O=parseInt(n[4],10),k=parseInt(n[5],10),Lr(q()),!0}function X(e){var t="No errors.",r="FEN string must contain six space-delimited fields.",n="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",f="1st field (piece positions) does not contain 8 '/'-delimited rows.",u="1st field (piece positions) is invalid [consecutive numbers].",d="1st field (piece positions) is invalid [invalid piece].",l="1st field (piece positions) is invalid [row too large].",c="Illegal en-passant square",e=e.split(/\s+/);if(6!==e.length)return{valid:!1,error_number:1,error:r};if(isNaN(parseInt(e[5]))||parseInt(e[5],10)<=0)return{valid:!1,error_number:2,error:n};if(isNaN(parseInt(e[4]))||parseInt(e[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(e[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(e[1]))return{valid:!1,error_number:6,error:s};var p=e[0].split("/");if(8!==p.length)return{valid:!1,error_number:7,error:f};for(var y=0;y<p.length;y++){for(var x=0,S=!1,T=0;T<p[y].length;T++)if(isNaN(p[y][T])){if(!/^[prnbqkPRNBQK]$/.test(p[y][T]))return{valid:!1,error_number:9,error:d};x+=1,S=!1}else{if(S)return{valid:!1,error_number:8,error:u};x+=parseInt(p[y][T],10),S=!0}if(8!==x)return{valid:!1,error_number:10,error:l}}return"3"==e[3][1]&&"w"==e[1]||"6"==e[3][1]&&"b"==e[1]?{valid:!1,error_number:11,error:c}:{valid:!0,error_number:0,error:t}}function q(){for(var e,t,r=0,n="",o=w.a8;o<=w.h1;o++)null==y[o]?r++:(0<r&&(n+=r,r=0),e=y[o].color,t=y[o].type,n+=e===A?t.toUpperCase():t.toLowerCase()),o+1&136&&(0<r&&(n+=r),o!==w.h1&&(n+="/"),r=0,o+=8);var i="",a=(T[A]&f.KSIDE_CASTLE&&(i+="K"),T[A]&f.QSIDE_CASTLE&&(i+="Q"),T[N]&f.KSIDE_CASTLE&&(i+="k"),T[N]&f.QSIDE_CASTLE&&(i+="q"),i=i||"-",C===E?"-":algebraic(C));return[n,S,i,a,O,k].join(" ")}function U(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(A[e[t]]=e[t+1]);return A}function Lr(e){0===N.length&&(e!==t?(A.SetUp="1",A.FEN=e):(delete A.SetUp,delete A.FEN))}function G(e){return y[w[e]]?{type:y[w[e]].type,color:y[w[e]].color}:null}function z(e,t){if(!("type"in e&&"color"in e))return!1;if(-1===e.type.toLowerCase().indexOf(e.type))return!1;if(!(t in w))return!1;t=w[t];return(e.type!=j||x[e.color]===E||x[e.color]===t)&&(y[t]={type:e.type,color:e.color},e.type===j&&(x[e.color]=t),Lr(q()),!0)}function V(e,t,r,n,o){return r={color:S,from:t,to:r,flags:n,piece:e[t].type},o&&(r.flags|=f.PROMOTION,r.promotion=o),e[r.to]?r.captured=e[r.to].type:n&f.EP_CAPTURE&&(r.captured=P),r}function Y(e){return new R(e)}var Q={load:function(e){return W(e)},reset:B,moves:function(e){for(var t=[],r=0,n=Y().moves(e);r<n.length;r++)t.push("verbose"in e&&e.verbose?n[r]:n[r].san);return t},in_check:function(){return!0},in_checkmate:function(){return!1},in_stalemate:function(){return!1},in_draw:function(){return!1},insufficient_material:function(){return!1},in_threefold_repetition:function(){return!1},game_over:function(){return!1},validate_fen:X,fen:q,board:function(){for(var e=[],t=[],r=w.a8;r<=w.h1;r++)null==y[r]?t.push(null):(e.push({square:algebraic(r),type:y[r].type,color:y[r].color}),r+1&136&&(e.push(t),t=[],r+=8));return e},pgn:function(){return""},load_pgn:function(){return!1},header:function(){return U(arguments)},turn:function(){return S},move:function(e){var t=null;return"string"==typeof e&&(t=U(e)),t&&(Y().move(t)),t},undo:function(){return null},clear:function(){return M()},put:z,get:G,ascii:function(){return""},remove:function(e){var t=G(e);return y[w[e]]=null,t&&t.type===j&&(x[t.color]=E),Lr(q()),t},perft:function(){return 0},square_color:function(e){return e in w?(rank(w[e])+file(w[e]))%2==0?"light":"dark":null},history:function(){return[]},get_comment:function(){return""},set_comment:function(){},delete_comment:function(){},get_comments:function(){return[]},delete_comments:function(){return[]}};return Q}return R});